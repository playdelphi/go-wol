# Go-WOL 多网卡支持改进日志

## 更改日期
2024年1月

## 问题描述
在多网卡环境下，原始的 `ipFromInterface` 函数存在以下问题：
1. 只返回第一个找到的非回环IPv4地址，可能选择错误的网卡
2. 错误信息不够详细，用户难以排查问题
3. 缺少列出可用网卡的功能

## 解决方案

### 1. 改进 ipFromInterface 函数 (wol.go:45-125)
- 添加了更详细的错误处理和提示信息
- 当接口不存在时，自动列出可用接口供用户参考
- 检查接口是否启用状态
- 提供更清晰的错误消息，包含接口名称

### 2. 新增 listNetworkInterfaces 函数 (wol.go:45-80)
- 列出所有可用的网络接口
- 显示接口名称、IPv4地址和MAC地址
- 自动跳过回环接口和未启用的接口
- 提供格式化的输出便于用户查看

### 3. 新增 interfaces 命令 (wol.go:167-170)
- 添加了 `interfacesCmd` 函数
- 允许用户通过命令行查看可用网络接口
- 更新了命令映射表 `cmdMap`

### 4. 更新帮助信息 (usage.go)
- 在 `validCommands` 中添加了 `interfaces` 命令
- 更新了使用说明，包含新的 interfaces 命令用法
- 添加了多网卡环境下的使用提示

## 技术细节

### 修改的文件
1. `cmd/wol/wol.go`
   - 重构 `ipFromInterface` 函数，增强错误处理
   - 新增 `listNetworkInterfaces` 函数
   - 新增 `interfacesCmd` 函数
   - 更新 `cmdMap` 映射表

2. `cmd/wol/usage.go`
   - 更新 `validCommands` 数组
   - 更新 `usageString` 帮助文本

### 新增功能
- `wol interfaces` 命令：列出所有可用的网络接口
- 改进的错误提示：当指定的接口不存在时，自动显示可用接口
- 接口状态检查：确保选择的接口处于启用状态

### 向后兼容性
- 所有现有功能保持不变
- 现有命令行参数和选项继续有效
- 不影响现有的别名和配置

## 使用示例

```bash
# 列出所有可用的网络接口
wol interfaces

# 使用特定接口发送魔术包
wol -i eth0 wake 00:11:22:33:44:55

# 当接口名称错误时，会自动显示可用接口
wol -i invalid_interface wake 00:11:22:33:44:55
```

## 测试建议
1. 在多网卡环境下测试接口选择功能
2. 测试 `wol interfaces` 命令输出
3. 测试错误接口名称时的提示信息
4. 验证现有功能的向后兼容性

## 注意事项
- 该改进主要针对多网卡环境下的使用体验
- 建议用户在多网卡环境下使用 `-i` 参数明确指定网卡
- 新增的 `interfaces` 命令可以帮助用户快速识别可用的网络接口